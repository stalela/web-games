
  /**
   * Create bright animated sun
   */
  createSun(width, height) {
    const sun = this.add.circle(width - 80, 80, 40, 0xFACA2A);
    sun.setStrokeStyle(3, 0xFFD93D);

    // Sun rays animation (scale)
    this.tweens.add({
      targets: sun,
      scale: 1.1,
      duration: 2000,
      yoyo: true,
      repeat: -1,
      ease: 'Sine.easeInOut'
    });

    // Sun rotation animation
    this.tweens.add({
      targets: sun,
      angle: 360,
      duration: 20000,
      repeat: -1,
      ease: 'Linear'
    });
  }

  /**
   * Create title area
   */
  createTitle(width, height) {
    const title = this.add.text(width / 2, 40, 'Lalela Web Games', {
      fontSize: '42px',
      color: '#FACA2A',
      fontStyle: 'bold',
      fontFamily: 'Fredoka One, cursive',
      stroke: '#FFFFFF',
      strokeThickness: 3
    }).setOrigin(0.5);

    const subtitle = this.add.text(width / 2, 85, 'Educational Games for Children', {
      fontSize: '20px',
      color: '#101012', // Ink Black for better contrast
      fontFamily: 'Nunito, sans-serif'
    }).setOrigin(0.5);
  }

  /**
   * Clear existing category buttons to prevent duplicates on scene restart
   */
  clearCategoryButtons() {
    if (this.categoryButtons) {
      this.categoryButtons.forEach(btn => {
        if (btn.container && btn.container.destroy) btn.container.destroy();
        if (btn.circle && btn.circle.destroy) btn.circle.destroy();
        if (btn.shadow && btn.shadow.destroy) btn.shadow.destroy();
        if (btn.icon && btn.icon.destroy) btn.icon.destroy();
        if (btn.nameText && btn.nameText.destroy) btn.nameText.destroy();
      });
    }
    this.categoryButtons = [];
  }

  /**
   * Create category bar with animal icons (Sticker Style)
   */
  createCategoryBar(width, height) {
    const barHeight = 140;
    const barY = 135;
    const iconSize = 85; // Increased size for more prominence
    const spacing = width / (this.categories.length + 1);

    // Background for category bar (no border for sticker look)
    const categoryBg = this.add.rectangle(width / 2, barY, width - 40, barHeight, 0xFDFAED, 0.95);

    // Category label
    this.add.text(width / 2, barY - barHeight / 2 - 15, 'Choose a Category', {
      fontSize: '18px',
      color: '#101012',
      fontFamily: 'Nunito, sans-serif',
      fontStyle: 'bold'
    }).setOrigin(0.5);

    // Create category buttons
    this.categories.forEach((category, index) => {
      const x = spacing * (index + 1);
      const y = barY;

      // Category circle background with drop shadow effect
      const circle = this.add.circle(x, y, iconSize / 2 + 15, category.color, 0.9);
      circle.setStrokeStyle(5, 0xFFFFFF); // Thick white stroke for sticker look

      // Add drop shadow (slightly offset darker circle)
      const shadow = this.add.circle(x + 2, y + 2, iconSize / 2 + 15, 0x000000, 0.3);
      circle.setInteractive({ useHandCursor: true });

      // Animal icon (larger and more prominent)
      const icon = this.add.sprite(x, y, category.icon.replace('.svg', ''));
      icon.setScale(iconSize / 100);
      icon.setTint(0xFFFFFF);

      // Category name (using Fredoka One as requested)
      const nameText = this.add.text(x, y + iconSize / 2 + 25, category.name, {
        fontSize: '16px', // Slightly larger
        color: '#101012',
        fontFamily: 'Fredoka One, cursive',
        align: 'center'
      }).setOrigin(0.5);

      // Hover effects (more pronounced)
      circle.on('pointerover', () => {
        circle.setFillStyle(Phaser.Display.Color.GetColor32(Phaser.Display.Color.IntegerToRGB(category.color).r * 1.3,
                                                           Phaser.Display.Color.IntegerToRGB(category.color).g * 1.3,
                                                           Phaser.Display.Color.IntegerToRGB(category.color).b * 1.3, 1));
        circle.setStrokeStyle(6, 0xFACA2A); // Lalela Yellow highlight
        icon.setScale(iconSize / 100 * 1.15); // More dramatic scale
      });

      circle.on('pointerout', () => {
        if (this.currentCategory !== category.id) {
          circle.setFillStyle(category.color);
          circle.setStrokeStyle(5, 0xFFFFFF);
          icon.setScale(iconSize / 100);
        }
      });

      circle.on('pointerdown', () => {
        this.selectCategory(category.id);
      });

      this.categoryButtons.push({
        circle: circle,
        shadow: shadow,
        icon: icon,
        text: nameText,
        category: category,
        originalY: y
      });
    });
  }

  /**
   * Select a category and filter games
   */
  selectCategory(categoryId) {
    this.currentCategory = categoryId;

    // Update category button appearances with bounce animation
    this.categoryButtons.forEach(btn => {
      if (btn.category.id === categoryId) {
        // Selected state: bounce animation and glowing background
        btn.circle.setStrokeStyle(6, 0xFACA2A); // Lalela Yellow border
        btn.circle.setFillStyle(0xFACA2A); // Glowing yellow background

        // Bounce animation (wiggle effect)
        this.tweens.add({
          targets: [btn.circle, btn.icon],
          y: btn.originalY - 10,
          duration: 150,
          yoyo: true,
          repeat: 1,
          ease: 'Back.easeOut',
          onComplete: () => {
            // Slight continuous wiggle
            this.tweens.add({
              targets: btn.icon,
              angle: 5,
              duration: 100,
              yoyo: true,
              repeat: 3,
              ease: 'Sine.easeInOut'
            });
          }
        });
      } else {
        // Unselected state
        btn.circle.setStrokeStyle(5, 0xFFFFFF);
        btn.circle.setFillStyle(btn.category.color);
        btn.icon.setAngle(0); // Reset rotation
        // Stop any ongoing tweens
        this.tweens.killTweensOf([btn.circle, btn.icon]);
      }
    });

    // Filter and show games with pop effect
    this.filterGamesByCategory(categoryId);

    // Play selection sound (if audio is available)
    if (this.app && this.app.audioManager) {
      this.app.audioManager.playSound('click');
    }
  }

  /**
   * Create responsive game grid
   */
  createGameGrid(width, height) {
    // Clear existing game cards to prevent duplicates when scene is restarted
    if (this.gameCards) {
      this.gameCards.forEach(card => {
        if (card && card.destroy) {
          card.destroy();
        }
      });
    }
    this.gameCards = [];

    // Calculate responsive grid
    const cardSize = Math.min(200, width / 6);
    const gridAreaTop = 270;
    const gridAreaBottom = height - 120;
    const gridAreaHeight = gridAreaBottom - gridAreaTop;

    this.gridConfig = {
      cardSize: cardSize,
      spacing: 30,
      areaTop: gridAreaTop,
      areaBottom: gridAreaBottom,
      areaLeft: 20,
      areaRight: width - 20
    };

    // Create game cards (initially hidden, will be shown by filter)
    this.allGames.forEach(game => {
      this.createGameCard(game);
    });
  }

  /**
   * Create individual game card (Sticker Style)
   */
  createGameCard(game) {
    const cardSize = this.gridConfig.cardSize;
    const card = this.add.container(0, 0);
    card.setVisible(false); // Initially hidden

    // Card background (white with more rounded corners and thicker border)
    const background = this.add.rectangle(0, 0, cardSize, cardSize * 1.3, 0xFFFFFF, 0.95);
    background.setStrokeStyle(4, 0x101012); // Thick Ink Black border
    card.add(background);

    // Game icon (top 80% of card - much larger for toddler appeal)
    const icon = this.add.sprite(0, -cardSize * 0.25, game.icon.replace('.svg', ''));
    icon.setScale((cardSize * 0.8) / 100); // 80% of card width
    card.add(icon);

    // Game name (bottom 20% of card - using Fredoka One)
    const nameText = this.add.text(0, cardSize * 0.4, game.name, {
      fontSize: '18px', // Larger for better readability
      color: '#101012',
      fontFamily: 'Fredoka One, cursive',
      align: 'center',
      wordWrap: { width: cardSize - 20 }
    }).setOrigin(0.5);
    card.add(nameText);

    // Difficulty stars (top-right corner with rotation animation)
    const stars = this.createDifficultyStars(game.difficulty, cardSize);
    stars.forEach(star => card.add(star));
    stars.forEach((star, index) => {
      star.setPosition(cardSize * 0.35 - (stars.length - 1 - index) * 20, -cardSize * 0.55);
    });

    // Make card interactive
    background.setInteractive({ useHandCursor: true });

    background.on('pointerover', () => {
      card.setScale(1.08); // More dramatic scale for "grab-able" feel
      background.setStrokeStyle(5, 0xFACA2A); // Lalela Yellow border

      // Animate stars on hover
      stars.forEach((star, index) => {
        this.tweens.add({
          targets: star,
          angle: 360,
          duration: 1000 + index * 200,
          repeat: -1,
          ease: 'Linear'
        });
      });
    });

    background.on('pointerout', () => {
      card.setScale(1.0);
      background.setStrokeStyle(4, 0x101012); // Back to Ink Black

      // Stop star rotation
      stars.forEach(star => {
        this.tweens.killTweensOf(star);
        star.setAngle(0);
      });
    });

    background.on('pointerdown', () => {
      this.startGame(game.scene);
    });

    // Store card data
    card.gameData = game;
